<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Editar Perfil - MiniTwitter</title>
<style>
  body { font-family: Arial, sans-serif; background:#e6ecf0; margin:0; padding:0; }
  header { background:#1da1f2; color:white; padding:15px; font-size:24px; text-align:center; font-weight:bold; }
  .container { max-width:500px; margin:30px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  input, textarea { width:100%; padding:8px; margin-top:10px; border-radius:5px; border:1px solid #ccc; font-size:14px; }
  textarea { height:80px; resize:none; }
  button { background:#1da1f2; color:white; padding:10px 15px; border:none; border-radius:5px; font-size:14px; cursor:pointer; margin-top:10px; }
  button:hover { background:#0d8ddb; }
  .profile-preview { display:flex; align-items:center; margin-bottom:15px; }
  .profile-preview img { width:60px; height:60px; border-radius:50%; margin-right:10px; }
</style>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>

<header>Editar Perfil</header>

<div class="container">
  <div class="profile-preview">
    <img id="profile-pic" src="https://via.placeholder.com/60" alt="Avatar">
    <div>
      <strong id="profile-name">Usuário</strong><br>
      <span id="profile-bio">Bio não definida</span>
    </div>
  </div>

  <input type="text" id="avatar-input" placeholder="URL do avatar">
  <input type="text" id="name-input" placeholder="Nome de usuário">
  <textarea id="bio-input" placeholder="Sua bio"></textarea>
  <button onclick="saveProfile()">Salvar Alterações</button>
  <button onclick="goBack()">Voltar</button>
</div>

<script>
  // Configuração Firebase - substitua pelos valores do seu projeto
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_PROJECT_ID.firebaseapp.com",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let currentUser = localStorage.getItem("currentUser");
  if(!currentUser){
    alert("Nenhum usuário logado! Redirecionando...");
    window.location.href = "index.html"; // página principal do MiniTwitter
  }

  const profilePic = document.getElementById("profile-pic");
  const profileName = document.getElementById("profile-name");
  const profileBio = document.getElementById("profile-bio");
  const avatarInput = document.getElementById("avatar-input");
  const nameInput = document.getElementById("name-input");
  const bioInput = document.getElementById("bio-input");

  async function loadProfile(){
    const userRef = db.collection("users").doc(currentUser);
    const doc = await userRef.get();
    if(doc.exists){
      const data = doc.data();
      profilePic.src = data.avatar || "https://via.placeholder.com/60";
      profileName.textContent = data.name;
      profileBio.textContent = data.bio || "Bio não definida";
      avatarInput.value = data.avatar || "";
      nameInput.value = data.name;
      bioInput.value = data.bio || "";
    }
  }

  async function saveProfile(){
    const newAvatar = avatarInput.value.trim() || "https://via.placeholder.com/60";
    const newName = nameInput.value.trim();
    const newBio = bioInput.value.trim();

    if(!newName){ alert("Nome de usuário não pode estar vazio"); return; }

    const userRef = db.collection("users").doc(currentUser);

    // Se o usuário mudou o nome, precisamos criar novo doc e apagar antigo
    if(newName !== currentUser){
      const newRef = db.collection("users").doc(newName);
      const doc = await newRef.get();
      if(doc.exists){ alert("Nome de usuário já existe!"); return; }

      const data = { avatar:newAvatar, bio:newBio, name:newName };
      await newRef.set(data);
      await userRef.delete();
      currentUser = newName;
      localStorage.setItem("currentUser", newName);
    } else {
      await userRef.update({ avatar:newAvatar, bio:newBio });
    }

    alert("Perfil atualizado com sucesso!");
    profilePic.src = newAvatar;
    profileName.textContent = newName;
    profileBio.textContent = newBio;
  }

  function goBack(){
    window.location.href = "index.html"; // volta para a página principal
  }

  loadProfile();
</script>

</body>
</html>
